{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.VoiceDatePicker = void 0;\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar react_client_1 = require(\"@speechly/react-client\");\n\nvar Calendar_1 = require(\"./Calendar\");\n\nvar CalendarIcon_1 = require(\"./CalendarIcon\");\n\nvar utils_1 = require(\"../utils\");\n\nvar VoiceDatePicker = function VoiceDatePicker(_a) {\n  var label = _a.label,\n      value = _a.value,\n      defaultValue = _a.defaultValue,\n      changeOnIntent = _a.changeOnIntent,\n      changeOnEntityType = _a.changeOnEntityType,\n      onChange = _a.onChange,\n      onFinal = _a.onFinal,\n      onBlur = _a.onBlur,\n      onFocus = _a.onFocus,\n      _b = _a.focused,\n      focused = _b === void 0 ? true : _b;\n  var inputEl = react_1.useRef(null);\n\n  var _c = react_1.useState(false),\n      _showCalendar = _c[0],\n      _setShowCalendar = _c[1];\n\n  var _d = react_1.useState(focused),\n      _focused = _d[0],\n      _setFocused = _d[1];\n\n  var _e = react_1.useState(defaultValue),\n      _date = _e[0],\n      _setDate = _e[1];\n\n  var _f = react_1.useState(defaultValue ? dateToString(defaultValue) : ''),\n      _value = _f[0],\n      _setValue = _f[1];\n\n  var _g = react_1.useState(defaultValue ? dateToString(defaultValue) : ''),\n      _lastGoodKnownValue = _g[0],\n      _setLastGoodKnownValue = _g[1];\n\n  var _h = react_1.useState(undefined),\n      lastSegmentId = _h[0],\n      setLastSegmentId = _h[1];\n\n  var segment = react_client_1.useSpeechContext().segment;\n\n  var _onChange = function _onChange(newValue) {\n    _setValue(newValue);\n\n    var newDate = stringToDate(newValue);\n\n    if (newDate) {\n      _setDate(newDate);\n\n      if (onChange) {\n        onChange(newDate);\n      }\n    }\n  };\n\n  function dateToString(date) {\n    return date.getDate().toString().padStart(2, '0') + \"/\" + (date.getMonth() + 1).toString().padStart(2, '0') + \"/\" + date.getFullYear();\n  }\n\n  function stringToDate(value) {\n    var regex = /([\\d]+)\\D([\\d]+)\\D(\\d\\d\\d\\d)/;\n    var matches = value.match(regex);\n    if (!matches) return null;\n    var all = matches[0],\n        day = matches[1],\n        month = matches[2],\n        year = matches[3];\n    return new Date(month + \" \" + day + \" \" + year);\n  }\n\n  var _onFocus = function _onFocus() {\n    _setFocused(true); // use callback only to change parent state\n\n\n    if (!focused && onFocus) {\n      onFocus();\n    }\n  };\n\n  var _onBlur = function _onBlur() {\n    // use callback only to change parent state\n    if (_focused) {\n      _setFocused(false);\n\n      if (onBlur) {\n        onBlur();\n      }\n    }\n  };\n\n  react_1.useEffect(function () {\n    if (value) {\n      _setValue(dateToString(value));\n\n      _setDate(value);\n    }\n  }, [value]);\n  react_1.useEffect(function () {\n    if (focused && !_focused && inputEl != null && inputEl.current != null) {\n      inputEl.current.focus();\n    }\n  }, [focused]);\n  react_1.useEffect(function () {\n    if (segment) {\n      var newValue = null;\n      var lastGoodKnownValue = _lastGoodKnownValue; // Update last good known value at new segment start\n\n      var segmentId = segment.contextId + \"/\" + segment.id;\n\n      if (segmentId !== lastSegmentId) {\n        setLastSegmentId(segmentId);\n        lastGoodKnownValue = value ? dateToString(value) : _value;\n\n        _setLastGoodKnownValue(lastGoodKnownValue);\n      } // Define newValue if the segment contains input targeted to this component\n\n\n      if (!changeOnIntent || segment.intent.intent === changeOnIntent) {\n        var entities = utils_1.formatEntities(segment.entities);\n\n        if (entities[changeOnEntityType] !== undefined) {\n          newValue = dateToString(new Date(Date.parse(entities[changeOnEntityType])));\n        }\n      } // _onChange to newValue only only if defined: tentative input may retarget to another component at any time\n      // otherwise reset to last good known value\n\n\n      _onChange(newValue !== null ? newValue : lastGoodKnownValue);\n\n      if (segment === null || segment === void 0 ? void 0 : segment.isFinal) {\n        if (inputEl != null && inputEl.current != null) {\n          inputEl.current.blur();\n        }\n\n        if (onFinal) {\n          onFinal();\n        }\n      }\n    }\n  }, [segment]);\n\n  var toggleCalendar = function toggleCalendar(e) {\n    e.preventDefault();\n\n    _setShowCalendar(!_showCalendar);\n  };\n\n  var onDatePick = function onDatePick(pickedDate) {\n    _setShowCalendar(!_showCalendar);\n\n    _onChange(dateToString(pickedDate));\n  };\n\n  return react_1.default.createElement(\"div\", {\n    className: \"widgetGroup inputText withCalendar\"\n  }, react_1.default.createElement(\"label\", null, label), react_1.default.createElement(\"input\", {\n    ref: inputEl,\n    type: \"text\",\n    name: changeOnEntityType,\n    value: _value,\n    onChange: function onChange(event) {\n      _onChange(event.target.value);\n    },\n    onBlur: _onBlur,\n    onFocus: _onFocus\n  }), react_1.default.createElement(\"button\", {\n    className: \"calendar-button\",\n    onClick: toggleCalendar\n  }, react_1.default.createElement(CalendarIcon_1.CalendarIcon, null)), _showCalendar && react_1.default.createElement(Calendar_1.Calendar, {\n    date: _date,\n    onDatePick: onDatePick\n  }));\n};\n\nexports.VoiceDatePicker = VoiceDatePicker;","map":null,"metadata":{},"sourceType":"script"}